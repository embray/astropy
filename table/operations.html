<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Table operations &mdash; Astropy v0.4rc3.dev9435</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4rc3.dev9435',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v0.4rc3.dev9435" href="../index.html" />
    <link rel="up" title="Data Tables (astropy.table)" href="index.html" />
    <link rel="next" title="Masking and missing values" href="masking.html" />
    <link rel="prev" title="Modifying a table" href="modify_table.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="masking.html" title="Masking and missing values">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="modify_table.html" title="Modifying a table">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v0.4rc3.dev9435</a>
	 &raquo;
      </li>
      <li><a href="index.html" accesskey="U">Data Tables (<tt class="docutils literal"><span class="pre">astropy.table</span></tt>)</a> &raquo;</li>
      
      <li>Table operations</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="table-operations">
<span id="id1"></span><h1>Table operations<a class="headerlink" href="#table-operations" title="Permalink to this headline">¶</a></h1>
<p>In this section we describe higher-level operations that can be used to generate a new
table from one or more input tables.  This includes:</p>
<hr class="docutils" />
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="52%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Documentation</th>
<th class="head">Description</th>
<th class="head">Function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#id2">Grouped operations</a></td>
<td>Group tables and columns by keys</td>
<td><a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table.group_by" title="astropy.table.Table.group_by"><tt class="xref py py-obj docutils literal"><span class="pre">group_by</span></tt></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#id3">Stack vertically</a></td>
<td>Concatenate input tables along rows</td>
<td><a class="reference internal" href="../api/astropy.table.vstack.html#astropy.table.vstack" title="astropy.table.vstack"><tt class="xref py py-obj docutils literal"><span class="pre">vstack</span></tt></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#id4">Stack horizontally</a></td>
<td>Concatenate input tables along columns</td>
<td><a class="reference internal" href="../api/astropy.table.hstack.html#astropy.table.hstack" title="astropy.table.hstack"><tt class="xref py py-obj docutils literal"><span class="pre">hstack</span></tt></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#join">Join</a></td>
<td>Database-style join of two tables</td>
<td><a class="reference internal" href="../api/astropy.table.join.html#astropy.table.join" title="astropy.table.join"><tt class="xref py py-obj docutils literal"><span class="pre">join</span></tt></a></td>
</tr>
</tbody>
</table>
<div class="section" id="grouped-operations">
<span id="id2"></span><h2>Grouped operations<a class="headerlink" href="#grouped-operations" title="Permalink to this headline">¶</a></h2>
<p>Sometimes in a table or table column there are natural groups within the dataset for which
it makes sense to compute some derived values.  A simple example is a list of objects with
photometry from various observing runs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obs</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;name    obs_date    mag_b  mag_v</span>
<span class="gp">... </span><span class="s">                    M31     2012-01-02  17.0   17.5</span>
<span class="gp">... </span><span class="s">                    M31     2012-01-02  17.1   17.4</span>
<span class="gp">... </span><span class="s">                    M101    2012-01-02  15.1   13.5</span>
<span class="gp">... </span><span class="s">                    M82     2012-02-14  16.2   14.5</span>
<span class="gp">... </span><span class="s">                    M31     2012-02-14  16.9   17.3</span>
<span class="gp">... </span><span class="s">                    M82     2012-02-14  15.2   15.5</span>
<span class="gp">... </span><span class="s">                    M101    2012-02-14  15.0   13.6</span>
<span class="gp">... </span><span class="s">                    M82     2012-03-26  15.7   16.5</span>
<span class="gp">... </span><span class="s">                    M101    2012-03-26  15.1   13.5</span>
<span class="gp">... </span><span class="s">                    M101    2012-03-26  14.8   14.3</span>
<span class="gp">... </span><span class="s">                    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="table-groups">
<h3>Table groups<a class="headerlink" href="#table-groups" title="Permalink to this headline">¶</a></h3>
<p>Now suppose we want the mean magnitudes for each object.  We first group the data by the
<tt class="docutils literal"><span class="pre">name</span></tt> column with the <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table.group_by" title="astropy.table.Table.group_by"><tt class="xref py py-func docutils literal"><span class="pre">group_by()</span></tt></a> method.  This returns
a new table sorted by <tt class="docutils literal"><span class="pre">name</span></tt> which has a <tt class="docutils literal"><span class="pre">groups</span></tt> property specifying the unique
values of <tt class="docutils literal"><span class="pre">name</span></tt> and the corresponding table rows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obs_by_name</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span>  
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go">M101 2012-01-02  15.1  13.5  &lt;&lt; First group (index=0, key=&#39;M101&#39;)</span>
<span class="go">M101 2012-02-14  15.0  13.6</span>
<span class="go">M101 2012-03-26  15.1  13.5</span>
<span class="go">M101 2012-03-26  14.8  14.3</span>
<span class="go"> M31 2012-01-02  17.0  17.5  &lt;&lt; Second group (index=4, key=&#39;M31&#39;)</span>
<span class="go"> M31 2012-01-02  17.1  17.4</span>
<span class="go"> M31 2012-02-14  16.9  17.3</span>
<span class="go"> M82 2012-02-14  16.2  14.5  &lt;&lt; Third group (index=7, key=&#39;M83&#39;)</span>
<span class="go"> M82 2012-02-14  15.2  15.5</span>
<span class="go"> M82 2012-03-26  15.7  16.5</span>
<span class="go">                             &lt;&lt; End of groups (index=10)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span>
<span class="go">name</span>
<span class="go">----</span>
<span class="go">M101</span>
<span class="go"> M31</span>
<span class="go"> M82</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">indices</span>
<span class="go">[ 0  4  7 10]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">groups</span></tt> property is the portal to all grouped operations with tables and columns.
It defines how the table is grouped via an array of the unique row key values and the
indices of the group boundaries for those key values.  The groups here correspond to the
row slices <tt class="docutils literal"><span class="pre">0:4</span></tt>, <tt class="docutils literal"><span class="pre">4:7</span></tt>, and <tt class="docutils literal"><span class="pre">7:10</span></tt> in the <tt class="docutils literal"><span class="pre">obs_by_name</span></tt> table.</p>
<p>The initial argument (<tt class="docutils literal"><span class="pre">keys</span></tt>) for the <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table.group_by" title="astropy.table.Table.group_by"><tt class="xref py py-obj docutils literal"><span class="pre">group_by</span></tt></a> function
can take a number of input data types:</p>
<ul class="simple">
<li>Single string value with a table column name (as shown above)</li>
<li>List of string values with table column names</li>
<li>Another <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> or <a class="reference internal" href="../api/astropy.table.Column.html#astropy.table.Column" title="astropy.table.Column"><tt class="xref py py-class docutils literal"><span class="pre">Column</span></tt></a> with same length as table</li>
<li>Numpy structured array with same length as table</li>
<li>Numpy homogeneous array with same length as table</li>
</ul>
<p>In all cases the corresponding row elements are considered as a tuple of values which
form a key value that is used to sort the original table and generate
the required groups.</p>
<p>As an example, to get the average magnitudes for each object on each observing
night, we would first group the table on both <tt class="docutils literal"><span class="pre">name</span></tt> and <tt class="docutils literal"><span class="pre">obs_date</span></tt> as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;obs_date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span>
<span class="go">name  obs_date</span>
<span class="go">---- ----------</span>
<span class="go">M101 2012-01-02</span>
<span class="go">M101 2012-02-14</span>
<span class="go">M101 2012-03-26</span>
<span class="go"> M31 2012-01-02</span>
<span class="go"> M31 2012-02-14</span>
<span class="go"> M82 2012-02-14</span>
<span class="go"> M82 2012-03-26</span>
</pre></div>
</div>
</div>
<div class="section" id="manipulating-groups">
<h3>Manipulating groups<a class="headerlink" href="#manipulating-groups" title="Permalink to this headline">¶</a></h3>
<p>Once you have applied grouping to a table then you can easily access the individual
groups or subsets of groups.  In all cases this returns a new grouped table.
For instance to get the sub-table which corresponds to the second group (index=1)
do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go"> M31 2012-01-02  17.0  17.5</span>
<span class="go"> M31 2012-01-02  17.1  17.4</span>
<span class="go"> M31 2012-02-14  16.9  17.3</span>
</pre></div>
</div>
<p>To get the first and second groups together use a slice:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">groups01</span> <span class="o">=</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">groups01</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go">M101 2012-01-02  15.1  13.5</span>
<span class="go">M101 2012-02-14  15.0  13.6</span>
<span class="go">M101 2012-03-26  15.1  13.5</span>
<span class="go">M101 2012-03-26  14.8  14.3</span>
<span class="go"> M31 2012-01-02  17.0  17.5</span>
<span class="go"> M31 2012-01-02  17.1  17.4</span>
<span class="go"> M31 2012-02-14  16.9  17.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">groups01</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span>
<span class="go">name</span>
<span class="go">----</span>
<span class="go">M101</span>
<span class="go"> M31</span>
</pre></div>
</div>
<p>You can also supply a numpy array of indices or a boolean mask to select particular
groups, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;M101&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go">M101 2012-01-02  15.1  13.5</span>
<span class="go">M101 2012-02-14  15.0  13.6</span>
<span class="go">M101 2012-03-26  15.1  13.5</span>
<span class="go">M101 2012-03-26  14.8  14.3</span>
</pre></div>
</div>
<p>One can iterate over the group sub-tables and corresponding keys with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;****** {0} *******&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]))</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">group</span>
<span class="gp">... </span>    <span class="k">print</span>
<span class="gp">...</span>
<span class="go">****** M101 *******</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go">M101 2012-01-02  15.1  13.5</span>
<span class="go">M101 2012-02-14  15.0  13.6</span>
<span class="go">M101 2012-03-26  15.1  13.5</span>
<span class="go">M101 2012-03-26  14.8  14.3</span>
<span class="go">****** M31 *******</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go"> M31 2012-01-02  17.0  17.5</span>
<span class="go"> M31 2012-01-02  17.1  17.4</span>
<span class="go"> M31 2012-02-14  16.9  17.3</span>
<span class="go">****** M82 *******</span>
<span class="go">name  obs_date  mag_b mag_v</span>
<span class="go">---- ---------- ----- -----</span>
<span class="go"> M82 2012-02-14  16.2  14.5</span>
<span class="go"> M82 2012-02-14  15.2  15.5</span>
<span class="go"> M82 2012-03-26  15.7  16.5</span>
</pre></div>
</div>
</div>
<div class="section" id="column-groups">
<h3>Column Groups<a class="headerlink" href="#column-groups" title="Permalink to this headline">¶</a></h3>
<p>Like <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> objects, <a class="reference internal" href="../api/astropy.table.Column.html#astropy.table.Column" title="astropy.table.Column"><tt class="xref py py-class docutils literal"><span class="pre">Column</span></tt></a> objects can also be grouped for subsequent
manipulation with grouped operations.  This can apply both to columns within a
<a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> or bare <a class="reference internal" href="../api/astropy.table.Column.html#astropy.table.Column" title="astropy.table.Column"><tt class="xref py py-class docutils literal"><span class="pre">Column</span></tt></a> objects.</p>
<p>As for <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a>, the grouping is generated with the
<a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table.group_by" title="astropy.table.Table.group_by"><tt class="xref py py-obj docutils literal"><span class="pre">group_by</span></tt></a> method.  The difference here is that
there is no option of providing one or more column names since that
doesn&#8217;t make sense for a <a class="reference internal" href="../api/astropy.table.Column.html#astropy.table.Column" title="astropy.table.Column"><tt class="xref py py-class docutils literal"><span class="pre">Column</span></tt></a>.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Column</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">key_vals</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">cg</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">cg</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;****** {0} *******&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">group</span>
<span class="gp">... </span>    <span class="k">print</span>
<span class="gp">...</span>
<span class="go">****** bar *******</span>
<span class="go"> a</span>
<span class="go">---</span>
<span class="go">  2</span>
<span class="go">****** foo *******</span>
<span class="go"> a</span>
<span class="go">---</span>
<span class="go">  1</span>
<span class="go">  3</span>
<span class="go">  4</span>
<span class="go">****** qux *******</span>
<span class="go"> a</span>
<span class="go">---</span>
<span class="go">  5</span>
<span class="go">  6</span>
</pre></div>
</div>
</div>
<div class="section" id="aggregation">
<h3>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h3>
<p>Aggregation is the process of applying a
specified reduction function to the values within each group for each
non-key column.  This function must accept a numpy array as the first
argument and return a single scalar value.  Common function examples are
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.sum.html#numpy.sum" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.sum</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.mean.html#numpy.mean" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.mean</span></tt></a>, and <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.std.html#numpy.std" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.std</span></tt></a>.</p>
<p>For the example grouped table <tt class="docutils literal"><span class="pre">obs_by_name</span></tt> from above we compute the group means with
the <a class="reference internal" href="../api/astropy.table.TableGroups.html#astropy.table.TableGroups.aggregate" title="astropy.table.groups.TableGroups"><tt class="xref py py-obj docutils literal"><span class="pre">aggregate</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obs_mean</span> <span class="o">=</span> <span class="n">obs_by_name</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>  
<span class="go">WARNING: Cannot aggregate column &#39;obs_date&#39; [astropy.table.groups]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_mean</span>  
<span class="go">name mag_b mag_v</span>
<span class="go">---- ----- ------</span>
<span class="go">M101  15.0 13.725</span>
<span class="go"> M31  17.0   17.4</span>
<span class="go"> M82  15.7   15.5</span>
</pre></div>
</div>
<p>It seems the magnitude values were successfully averaged, but what
about the WARNING?  Since the <tt class="docutils literal"><span class="pre">obs_date</span></tt> column is a string-type
array, the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.mean.html#numpy.mean" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.mean</span></tt></a> function failed and raised an exception.
Any time this happens then <a class="reference internal" href="../api/astropy.table.TableGroups.html#astropy.table.TableGroups.aggregate" title="astropy.table.groups.TableGroups"><tt class="xref py py-obj docutils literal"><span class="pre">aggregate</span></tt></a>
will issue a warning and then
drop that column from the output result.  Note that the <tt class="docutils literal"><span class="pre">name</span></tt>
column is one of the <tt class="docutils literal"><span class="pre">keys</span></tt> used to determine the grouping so
it is automatically ignored from aggregation.</p>
<p>From a grouped table it is possible to select one or more columns on which
to perform the aggregation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="p">[</span><span class="s">&#39;mag_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="go">mag_b</span>
<span class="go">-----</span>
<span class="go"> 15.0</span>
<span class="go"> 17.0</span>
<span class="go"> 15.7</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obs_by_name</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;mag_v&#39;</span><span class="p">,</span> <span class="s">&#39;mag_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="go">name mag_v  mag_b</span>
<span class="go">---- ------ -----</span>
<span class="go">M101 13.725  15.0</span>
<span class="go"> M31   17.4  17.0</span>
<span class="go"> M82   15.5  15.7</span>
</pre></div>
</div>
<p>A single column of data can be aggregated as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Column</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">key_vals</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cg_sums</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cg_sum</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">cg</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="n">cg_sums</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&#39;Sum for {0} = {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cg_sum</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Sum for bar = 2</span>
<span class="go">Sum for foo = 8</span>
<span class="go">Sum for qux = 11</span>
</pre></div>
</div>
<p>If the specified function has a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.reduceat.html#numpy.ufunc.reduceat" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.ufunc.reduceat</span></tt></a> method, this will be called instead.
This can improve the performance by a factor of 10 to 100 (or more) for large unmasked
tables or columns with many relatively small groups.  It also allows for the use of
certain numpy functions which normally take more than one input array but also work as
reduction functions, like <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.add.html#numpy.add" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.add</span></tt></a>.  The numpy functions which should take advantage of
using <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ufunc.reduceat.html#numpy.ufunc.reduceat" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.ufunc.reduceat</span></tt></a> include:</p>
<p><a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.add.html#numpy.add" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.add</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.arctan2.html#numpy.arctan2" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.arctan2</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.bitwise_and.html#numpy.bitwise_and" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.bitwise_and</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.bitwise_or.html#numpy.bitwise_or" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.bitwise_or</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.bitwise_xor.html#numpy.bitwise_xor" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.bitwise_xor</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.copysign.html#numpy.copysign" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.copysign</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.divide.html#numpy.divide" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.divide</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.equal.html#numpy.equal" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.equal</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.floor_divide.html#numpy.floor_divide" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.floor_divide</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.fmax.html#numpy.fmax" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.fmax</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.fmin.html#numpy.fmin" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.fmin</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.fmod.html#numpy.fmod" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.fmod</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.greater_equal.html#numpy.greater_equal" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.greater_equal</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.greater.html#numpy.greater" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.greater</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.hypot.html#numpy.hypot" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.hypot</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.left_shift.html#numpy.left_shift" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.left_shift</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.less_equal.html#numpy.less_equal" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.less_equal</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.less.html#numpy.less" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.less</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logaddexp2.html#numpy.logaddexp2" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.logaddexp2</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logaddexp.html#numpy.logaddexp" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.logaddexp</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logical_and.html#numpy.logical_and" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.logical_and</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logical_or.html#numpy.logical_or" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.logical_or</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logical_xor.html#numpy.logical_xor" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.logical_xor</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.maximum.html#numpy.maximum" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.maximum</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.minimum.html#numpy.minimum" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.minimum</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.mod.html#numpy.mod" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.mod</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.multiply.html#numpy.multiply" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.multiply</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.not_equal.html#numpy.not_equal" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.not_equal</span></tt></a>,
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.power.html#numpy.power" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.power</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.remainder.html#numpy.remainder" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.remainder</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.right_shift.html#numpy.right_shift" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.right_shift</span></tt></a>, <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.subtract.html#numpy.subtract" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.subtract</span></tt></a> and <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.true_divide.html#numpy.true_divide" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.true_divide</span></tt></a>.</p>
<p>As special cases <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.sum.html#numpy.sum" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.sum</span></tt></a> and <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.mean.html#numpy.mean" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.mean</span></tt></a> are substituted with their
respective reduceat methods.</p>
</div>
<div class="section" id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h3>
<p>Table groups can be filtered by means of the
<a class="reference internal" href="../api/astropy.table.TableGroups.html#astropy.table.TableGroups.filter" title="astropy.table.groups.TableGroups"><tt class="xref py py-obj docutils literal"><span class="pre">filter</span></tt></a> method.  This is done by
supplying a function which is called for each group.  The function
which is passed to this method must accept two arguments:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">table</span></tt> : <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> object</li>
<li><tt class="docutils literal"><span class="pre">key_colnames</span></tt> : list of columns in <tt class="docutils literal"><span class="pre">table</span></tt> used as keys for grouping</li>
</ul>
<p>It must then return either <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/constants.html#False" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">False</span></tt></a>.  As an example, the following
will select all table groups with only positive values in the non-key columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">all_positive</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">key_colnames</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">colnames</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_colnames</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">colnames</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">False</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>An example of using this function is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot; a   b    c</span>
<span class="gp">... </span><span class="s">                  -2  7.0   0</span>
<span class="gp">... </span><span class="s">                  -2  5.0   1</span>
<span class="gp">... </span><span class="s">                   1  3.0  -5</span>
<span class="gp">... </span><span class="s">                   1 -2.0  -6</span>
<span class="gp">... </span><span class="s">                   1  1.0   7</span>
<span class="gp">... </span><span class="s">                   0  0.0   4</span>
<span class="gp">... </span><span class="s">                   3  3.0   5</span>
<span class="gp">... </span><span class="s">                   3 -2.0   6</span>
<span class="gp">... </span><span class="s">                   3  1.0   7&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tg</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_positive</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">all_positive</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">t_positive</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">group</span>
<span class="gp">... </span>    <span class="k">print</span>
<span class="gp">...</span>
<span class="go"> a   b   c</span>
<span class="go">--- --- ---</span>
<span class="go"> -2 7.0   0</span>
<span class="go"> -2 5.0   1</span>

<span class="go"> a   b   c</span>
<span class="go">--- --- ---</span>
<span class="go">  0 0.0   4</span>
</pre></div>
</div>
<p>As can be seen only the groups with <tt class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">-2</span></tt> and <tt class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">0</span></tt> have all positive values
in the non-key columns, so those are the ones that are selected.</p>
<p>Likewise a grouped column can be filtered with the
<a class="reference internal" href="../api/astropy.table.ColumnGroups.html#astropy.table.ColumnGroups.filter" title="astropy.table.groups.ColumnGroups"><tt class="xref py py-obj docutils literal"><span class="pre">filter</span></tt></a>, method but in this case the filtering
function takes only a single argument which is the column group.  It still must return
either <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/constants.html#False" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">False</span></tt></a>.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">all_positive</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">column</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stack-vertically">
<span id="id3"></span><h2>Stack vertically<a class="headerlink" href="#stack-vertically" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> class supports stacking tables vertically with the
<a class="reference internal" href="../api/astropy.table.vstack.html#astropy.table.vstack" title="astropy.table.vstack"><tt class="xref py py-obj docutils literal"><span class="pre">vstack</span></tt></a> function.  This process is also commonly known as
concatenating or appending tables in the row direction.  It corresponds roughly
to the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.vstack.html#numpy.vstack" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.vstack</span></tt></a> function.</p>
<p>For example, suppose one has two tables of observations with several
column names in common:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obs1</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;name    obs_date    mag_b  logLx</span>
<span class="gp">... </span><span class="s">                     M31     2012-01-02  17.0   42.5</span>
<span class="gp">... </span><span class="s">                     M82     2012-10-29  16.2   43.5</span>
<span class="gp">... </span><span class="s">                     M101    2012-10-31  15.1   44.5&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">obs2</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;name    obs_date    logLx</span>
<span class="gp">... </span><span class="s">                     NGC3516 2011-11-11  42.1</span>
<span class="gp">... </span><span class="s">                     M31     1999-01-05  43.1</span>
<span class="gp">... </span><span class="s">                     M82     2012-10-30  45.0&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can stack these two tables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">vstack</span><span class="p">([</span><span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">])</span>
<span class="go">  name   obs_date  mag_b logLx</span>
<span class="go">------- ---------- ----- -----</span>
<span class="go">    M31 2012-01-02  17.0  42.5</span>
<span class="go">    M82 2012-10-29  16.2  43.5</span>
<span class="go">   M101 2012-10-31  15.1  44.5</span>
<span class="go">NGC3516 2011-11-11    --  42.1</span>
<span class="go">    M31 1999-01-05    --  43.1</span>
<span class="go">    M82 2012-10-30    --  45.0</span>
</pre></div>
</div>
<p>Notice that the <tt class="docutils literal"><span class="pre">obs2</span></tt> table is missing the <tt class="docutils literal"><span class="pre">mag_b</span></tt> column, so in the stacked output
table those values are marked as missing.  This is the default behavior and corresponds to
<tt class="docutils literal"><span class="pre">join_type='outer'</span></tt>.  There are two other allowed values for the <tt class="docutils literal"><span class="pre">join_type</span></tt> argument,
<tt class="docutils literal"><span class="pre">'inner'</span></tt> and <tt class="docutils literal"><span class="pre">'exact'</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">vstack</span><span class="p">([</span><span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">],</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">)</span>
<span class="go">  name   obs_date  logLx</span>
<span class="go">------- ---------- -----</span>
<span class="go">    M31 2012-01-02  42.5</span>
<span class="go">    M82 2012-10-29  43.5</span>
<span class="go">   M101 2012-10-31  44.5</span>
<span class="go">NGC3516 2011-11-11  42.1</span>
<span class="go">    M31 1999-01-05  43.1</span>
<span class="go">    M82 2012-10-30  45.0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">vstack</span><span class="p">([</span><span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">],</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TableMergeError</span>: <span class="n">Inconsistent columns in input arrays (use &#39;inner&#39;</span>
<span class="go">or &#39;outer&#39; join_type to allow non-matching columns)</span>
</pre></div>
</div>
<p>In the case of <tt class="docutils literal"><span class="pre">join_type='inner'</span></tt>, only the common columns (the intersection) are
present in the output table.  When <tt class="docutils literal"><span class="pre">join_type='exact'</span></tt> is specified then
<a class="reference internal" href="../api/astropy.table.vstack.html#astropy.table.vstack" title="astropy.table.vstack"><tt class="xref py py-obj docutils literal"><span class="pre">vstack</span></tt></a> requires that all the input tables
have exactly the same column names.</p>
<p>More than two tables can be stacked by supplying a list of table objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obs3</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;name    obs_date    mag_b  logLx</span>
<span class="gp">... </span><span class="s">                     M45     2012-02-03  15.0   40.5&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">vstack</span><span class="p">([</span><span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">obs3</span><span class="p">])</span>
<span class="go">  name   obs_date  mag_b logLx</span>
<span class="go">------- ---------- ----- -----</span>
<span class="go">    M31 2012-01-02  17.0  42.5</span>
<span class="go">    M82 2012-10-29  16.2  43.5</span>
<span class="go">   M101 2012-10-31  15.1  44.5</span>
<span class="go">NGC3516 2011-11-11    --  42.1</span>
<span class="go">    M31 1999-01-05    --  43.1</span>
<span class="go">    M82 2012-10-30    --  45.0</span>
<span class="go">    M45 2012-02-03  15.0  40.5</span>
</pre></div>
</div>
<p>See also the sections on <a class="reference internal" href="#merging-metadata">Merging metadata</a> and <a class="reference internal" href="#merging-column-attributes">Merging column
attributes</a> for details on how these characteristics of the input tables are merged in
the single output table.  Note also that you can use a single table row instead of a
full table as one of the inputs.</p>
</div>
<div class="section" id="stack-horizontally">
<span id="id4"></span><h2>Stack horizontally<a class="headerlink" href="#stack-horizontally" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> class supports stacking tables horizontally (in the column-wise direction) with the
<a class="reference internal" href="../api/astropy.table.hstack.html#astropy.table.hstack" title="astropy.table.hstack"><tt class="xref py py-obj docutils literal"><span class="pre">hstack</span></tt></a> function.    It corresponds roughly
to the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.hstack.html#numpy.hstack" title="(in NumPy v1.8)"><tt class="xref py py-obj docutils literal"><span class="pre">numpy.hstack</span></tt></a> function.</p>
<p>For example, suppose one has the following two tables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">hstack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;a   b    c</span>
<span class="gp">... </span><span class="s">                   1   foo  1.4</span>
<span class="gp">... </span><span class="s">                   2   bar  2.1</span>
<span class="gp">... </span><span class="s">                   3   baz  2.8&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;d     e</span>
<span class="gp">... </span><span class="s">                   ham   eggs</span>
<span class="gp">... </span><span class="s">                   spam  toast&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can stack these two tables horizontally:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">hstack</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
<span class="go"> a   b   c   d     e</span>
<span class="go">--- --- --- ---- -----</span>
<span class="go">  1 foo 1.4  ham  eggs</span>
<span class="go">  2 bar 2.1 spam toast</span>
<span class="go">  3 baz 2.8   --    --</span>
</pre></div>
</div>
<p>As with <a class="reference internal" href="../api/astropy.table.vstack.html#astropy.table.vstack" title="astropy.table.vstack"><tt class="xref py py-obj docutils literal"><span class="pre">vstack</span></tt></a>, there is an optional <tt class="docutils literal"><span class="pre">join_type</span></tt> argument
that can take values <tt class="docutils literal"><span class="pre">'inner'</span></tt>, <tt class="docutils literal"><span class="pre">'exact'</span></tt>, and <tt class="docutils literal"><span class="pre">'outer'</span></tt>.  The default is
<tt class="docutils literal"><span class="pre">'outer'</span></tt>, which effectively takes the union of available rows and masks out any missing
values.  This is illustrated in the example above.  The other options give the
intersection of rows, where <tt class="docutils literal"><span class="pre">'exact'</span></tt> requires that all tables have exactly the same
number of rows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">hstack</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">],</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">)</span>
<span class="go"> a   b   c   d     e</span>
<span class="go">--- --- --- ---- -----</span>
<span class="go">  1 foo 1.4  ham  eggs</span>
<span class="go">  2 bar 2.1 spam toast</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">hstack</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">],</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TableMergeError</span>: <span class="n">Inconsistent number of rows in input arrays (use &#39;inner&#39; or</span>
<span class="go">&#39;outer&#39; join_type to allow non-matching rows)</span>
</pre></div>
</div>
<p>More than two tables can be stacked by supplying a list of table objects.  The example
below also illustrates the behavior when there is a conflict in the input column names
(see the section on <a class="reference internal" href="#column-renaming">Column renaming</a> for details):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;a    b</span>
<span class="gp">... </span><span class="s">                   M45  2012-02-03&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">hstack</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">])</span>
<span class="go">a_1 b_1  c   d     e   a_3    b_3</span>
<span class="go">--- --- --- ---- ----- --- ----------</span>
<span class="go">  1 foo 1.4  ham  eggs M45 2012-02-03</span>
<span class="go">  2 bar 2.1 spam toast  --         --</span>
<span class="go">  3 baz 2.8   --    --  --         --</span>
</pre></div>
</div>
<p>The metadata from the input tables is merged by the process described in the <a class="reference internal" href="#merging-metadata">Merging
metadata</a> section.  Note also that you can use a single table row instead of a
full table as one of the inputs.</p>
</div>
<div class="section" id="join">
<span id="table-join"></span><h2>Join<a class="headerlink" href="#join" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> class supports the <a class="reference external" href="http://en.wikipedia.org/wiki/Join_(SQL)">database join</a>
operation.  This provides a flexible and powerful way to combine tables based on the
values in one or more key columns.</p>
<p>For example, suppose one has two tables of observations, the first with B and V magnitudes
and the second with X-ray luminosities of an overlapping (but not identical) sample:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">join</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">optical</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;name    obs_date    mag_b  mag_v</span>
<span class="gp">... </span><span class="s">                        M31     2012-01-02  17.0   16.0</span>
<span class="gp">... </span><span class="s">                        M82     2012-10-29  16.2   15.2</span>
<span class="gp">... </span><span class="s">                        M101    2012-10-31  15.1   15.5&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xray</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;&quot;&quot;   name    obs_date    logLx</span>
<span class="gp">... </span><span class="s">                        NGC3516 2011-11-11  42.1</span>
<span class="gp">... </span><span class="s">                        M31     1999-01-05  43.1</span>
<span class="gp">... </span><span class="s">                        M82     2012-10-29  45.0&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../api/astropy.table.join.html#astropy.table.join" title="astropy.table.join"><tt class="xref py py-func docutils literal"><span class="pre">join()</span></tt></a> method allows one to merge these two tables into a single table based on
matching values in the &#8220;key columns&#8221;.  By default the key columns are the set of columns
that are common to both tables.  In this case the key columns are <tt class="docutils literal"><span class="pre">name</span></tt> and
<tt class="docutils literal"><span class="pre">obs_date</span></tt>.  We can find all the observations of the same object on the same date as
follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">opt_xray</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">opt_xray</span>
<span class="go">name  obs_date  mag_b mag_v logLx</span>
<span class="go">---- ---------- ----- ----- -----</span>
<span class="go"> M82 2012-10-29  16.2  15.2  45.0</span>
</pre></div>
</div>
<p>We can perform the match only by <tt class="docutils literal"><span class="pre">name</span></tt> by providing the <tt class="docutils literal"><span class="pre">keys</span></tt> argument, which can be
either a single column name or a list of column names:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">name obs_date_1 mag_b mag_v obs_date_2 logLx</span>
<span class="go">---- ---------- ----- ----- ---------- -----</span>
<span class="go"> M31 2012-01-02  17.0  16.0 1999-01-05  43.1</span>
<span class="go"> M82 2012-10-29  16.2  15.2 2012-10-29  45.0</span>
</pre></div>
</div>
<p>This output table has all observations that have both optical and X-ray data for an object
(M31 and M82).  Notice that since the <tt class="docutils literal"><span class="pre">obs_date</span></tt> column occurs in both tables it has
been split into two columns, <tt class="docutils literal"><span class="pre">obs_date_1</span></tt> and <tt class="docutils literal"><span class="pre">obs_date_2</span></tt>.  The values are taken from
the &#8220;left&#8221; (<tt class="docutils literal"><span class="pre">optical</span></tt>) and &#8220;right&#8221; (<tt class="docutils literal"><span class="pre">xray</span></tt>) tables, respectively.</p>
<p>The table joins so far are known as &#8220;inner&#8221; joins and represent the strict intersection of
the two tables on the key columns.</p>
<p>If one wants to make a new table which has <em>every</em> row from the left table and includes
matching values from the right table when available, this is known as a left join:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>
<span class="go">name  obs_date  mag_b mag_v logLx</span>
<span class="go">---- ---------- ----- ----- -----</span>
<span class="go">M101 2012-10-31  15.1  15.5    --</span>
<span class="go"> M31 2012-01-02  17.0  16.0    --</span>
<span class="go"> M82 2012-10-29  16.2  15.2  45.0</span>
</pre></div>
</div>
<p>Two of the observations do not have X-ray data, as indicated by the &#8220;&#8211;&#8221; in the table.
When there are any missing values the output will be a masked table.  You might be
surprised that there is no X-ray data for M31 in the output.  Remember that the default
matching key includes both <tt class="docutils literal"><span class="pre">name</span></tt> and <tt class="docutils literal"><span class="pre">obs_date</span></tt>.  Specifying the key as only the
<tt class="docutils literal"><span class="pre">name</span></tt> column gives:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
<span class="go">name obs_date_1 mag_b mag_v obs_date_2 logLx</span>
<span class="go">---- ---------- ----- ----- ---------- -----</span>
<span class="go">M101 2012-10-31  15.1  15.5         --    --</span>
<span class="go"> M31 2012-01-02  17.0  16.0 1999-01-05  43.1</span>
<span class="go"> M82 2012-10-29  16.2  15.2 2012-10-29  45.0</span>
</pre></div>
</div>
<p>Likewise one can construct a new table with every row of the right table and matching left
values (when available) using <tt class="docutils literal"><span class="pre">join_type='right'</span></tt>.</p>
<p>Finally, to make a table with the union of rows from both tables do an &#8220;outer&#8221; join:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">,</span> <span class="n">join_type</span><span class="o">=</span><span class="s">&#39;outer&#39;</span><span class="p">)</span>
<span class="go">  name   obs_date  mag_b mag_v logLx</span>
<span class="go">------- ---------- ----- ----- -----</span>
<span class="go">   M101 2012-10-31  15.1  15.5    --</span>
<span class="go">    M31 1999-01-05    --    --  43.1</span>
<span class="go">    M31 2012-01-02  17.0  16.0    --</span>
<span class="go">    M82 2012-10-29  16.2  15.2  45.0</span>
<span class="go">NGC3516 2011-11-11    --    --  42.1</span>
</pre></div>
</div>
<div class="section" id="identical-keys">
<h3>Identical keys<a class="headerlink" href="#identical-keys" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> join operation works even if there are multiple rows with identical key
values.  For example the following tables have multiple rows for the key column <tt class="docutils literal"><span class="pre">x</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">join</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">left</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;L1&#39;</span><span class="p">,</span> <span class="s">&#39;L2&#39;</span><span class="p">,</span> <span class="s">&#39;L3&#39;</span><span class="p">,</span> <span class="s">&#39;L4&#39;</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;L&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">right</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;R1&#39;</span><span class="p">,</span> <span class="s">&#39;R2&#39;</span><span class="p">,</span> <span class="s">&#39;R3&#39;</span><span class="p">,</span> <span class="s">&#39;R4&#39;</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">left</span>
<span class="go">key  L</span>
<span class="go">--- ---</span>
<span class="go">  0  L1</span>
<span class="go">  1  L2</span>
<span class="go">  1  L3</span>
<span class="go">  2  L4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">right</span>
<span class="go">key  R</span>
<span class="go">--- ---</span>
<span class="go">  1  R1</span>
<span class="go">  1  R2</span>
<span class="go">  2  R3</span>
<span class="go">  4  R4</span>
</pre></div>
</div>
<p>Doing an outer join on these tables shows that what is really happening is a <a class="reference external" href="http://en.wikipedia.org/wiki/Cartesian_product">Cartesian
product</a>.  For each matching key, every
combination of the left and right tables is represented.  When there is no match in either
the left or right table, the corresponding column values are designated as missing.</p>
<div class="highlight-python"><div class="highlight"><pre>win32

&gt;&gt;&gt; print join(left, right, join_type=&#39;outer&#39;)
key  L   R
--- --- ---
  0  L1  --
  1  L2  R1
  1  L2  R2
  1  L3  R1
  1  L3  R2
  2  L4  R3
  4  --  R4
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The output table is sorted on the key columns, but when there are rows with identical
keys the output order in the non-key columns is not guaranteed to be identical across
installations.  In the example above the order within the four rows with <tt class="docutils literal"><span class="pre">key</span> <span class="pre">==</span> <span class="pre">1</span></tt>
can vary.</p>
</div>
<p>An inner join is the same but only returns rows where there is a key match in both the
left and right tables:</p>
<div class="highlight-python"><div class="highlight"><pre>win32

&gt;&gt;&gt; print join(left, right, join_type=&#39;inner&#39;)
key  L   R
--- --- ---
  1  L2  R1
  1  L2  R2
  1  L3  R1
  1  L3  R2
  2  L4  R3
</pre></div>
</div>
<p>Conflicts in the input table names are handled by the process described in the section on
<a class="reference internal" href="#column-renaming">Column renaming</a>.  See also the sections on <a class="reference internal" href="#merging-metadata">Merging metadata</a> and <a class="reference internal" href="#merging-column-attributes">Merging column
attributes</a> for details on how these characteristics of the input tables are merged in
the single output table.</p>
</div>
</div>
<div class="section" id="merging-details">
<h2>Merging details<a class="headerlink" href="#merging-details" title="Permalink to this headline">¶</a></h2>
<p>When combining two or more tables there is the need to merge certain
characteristics in the inputs and potentially resolve conflicts.  This
section describes the process.</p>
<div class="section" id="column-renaming">
<h3>Column renaming<a class="headerlink" href="#column-renaming" title="Permalink to this headline">¶</a></h3>
<p>In cases where the input tables have conflicting column names, there
is a mechanism to generate unique output column names.  There are two
keyword arguments that control the renaming behavior:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">table_names</span></tt></dt>
<dd>Two-element list of strings that provide a name for the tables being joined.
By default this is <tt class="docutils literal"><span class="pre">['1',</span> <span class="pre">'2',</span> <span class="pre">...]</span></tt>, where the numbers correspond to
the input tables.</dd>
<dt><tt class="docutils literal"><span class="pre">uniq_col_name</span></tt></dt>
<dd>String format specifier with a default value of <tt class="docutils literal"><span class="pre">'{col_name}_{table_name}'</span></tt>.</dd>
</dl>
<p>This is most easily understood by example using the <tt class="docutils literal"><span class="pre">optical</span></tt> and <tt class="docutils literal"><span class="pre">xray</span></tt> tables
in the <a class="reference internal" href="../api/astropy.table.join.html#astropy.table.join" title="astropy.table.join"><tt class="xref py py-func docutils literal"><span class="pre">join()</span></tt></a> example defined previously:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">join</span><span class="p">(</span><span class="n">optical</span><span class="p">,</span> <span class="n">xray</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">table_names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;OPTICAL&#39;</span><span class="p">,</span> <span class="s">&#39;XRAY&#39;</span><span class="p">],</span>
<span class="gp">... </span>           <span class="n">uniq_col_name</span><span class="o">=</span><span class="s">&#39;{table_name}_{col_name}&#39;</span><span class="p">)</span>
<span class="go">name OPTICAL_obs_date mag_b mag_v XRAY_obs_date logLx</span>
<span class="go">---- ---------------- ----- ----- ------------- -----</span>
<span class="go"> M31       2012-01-02  17.0  16.0    1999-01-05  43.1</span>
<span class="go"> M82       2012-10-29  16.2  15.2    2012-10-29  45.0</span>
</pre></div>
</div>
</div>
<div class="section" id="merging-metadata">
<h3>Merging metadata<a class="headerlink" href="#merging-metadata" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../api/astropy.table.Table.html#astropy.table.Table" title="astropy.table.Table"><tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt></a> objects can have associated metadata:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Table.meta</span></tt>: table-level metadata as an ordered dictionary</li>
<li><tt class="docutils literal"><span class="pre">Column.meta</span></tt>: per-column metadata as an ordered dictionary</li>
</ul>
<p>The table operations described here handle the task of merging the metadata in the input
tables into a single output structure.  Because the metadata can be arbitrarily complex
there is no unique way to do the merge.  The current implementation uses a simple
recursive algorithm with four rules:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">dict</span></tt></a> elements are merged by keys</p>
</li>
<li><p class="first">Conflicting <a class="reference external" href="http://docs.python.org/library/functions.html#list" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">list</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/functions.html#tuple" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">tuple</span></tt></a> elements are concatenated</p>
</li>
<li><p class="first">Conflicting <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">dict</span></tt></a> elements are merged by recursively calling the merge function</p>
</li>
<li><dl class="first docutils">
<dt>Conflicting elements that are not both <a class="reference external" href="http://docs.python.org/library/functions.html#list" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">list</span></tt></a>, <a class="reference external" href="http://docs.python.org/library/functions.html#tuple" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">tuple</span></tt></a>, or <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">dict</span></tt></a> will follow the following rules:</dt>
<dd><ul class="first last simple">
<li>If both metadata values are identical, the output is set to this value</li>
<li>If one of the conflicting metadata values is <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a>, the other value is picked</li>
<li>If both metadata values are different and neither is <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a>, the one for the last table in the list is picked</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>By default, a warning is emitted in the last case (both metadata values are not
<a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a>). The warning can be silenced or made into an exception using the
<tt class="docutils literal"><span class="pre">metadata_conflicts</span></tt> argument to <a class="reference internal" href="../api/astropy.table.hstack.html#astropy.table.hstack" title="astropy.table.hstack"><tt class="xref py py-func docutils literal"><span class="pre">hstack()</span></tt></a>,
<a class="reference internal" href="../api/astropy.table.vstack.html#astropy.table.vstack" title="astropy.table.vstack"><tt class="xref py py-func docutils literal"><span class="pre">vstack()</span></tt></a>, or
<a class="reference internal" href="../api/astropy.table.join.html#astropy.table.join" title="astropy.table.join"><tt class="xref py py-func docutils literal"><span class="pre">join()</span></tt></a>. The <tt class="docutils literal"><span class="pre">metadata_conflicts</span></tt> option can be set to:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'silent'</span></tt> - no warning is emitted, the value for the last table is silently picked</li>
<li><tt class="docutils literal"><span class="pre">'warn'</span></tt> - a warning is emitted, the value for the last table is picked</li>
<li><tt class="docutils literal"><span class="pre">'error'</span></tt> - an exception is raised</li>
</ul>
</div>
<div class="section" id="merging-column-attributes">
<h3>Merging column attributes<a class="headerlink" href="#merging-column-attributes" title="Permalink to this headline">¶</a></h3>
<p>In addition to the table and column <tt class="docutils literal"><span class="pre">meta</span></tt> attributes, the column attributes <tt class="docutils literal"><span class="pre">unit</span></tt>,
<tt class="docutils literal"><span class="pre">format</span></tt>, and <tt class="docutils literal"><span class="pre">description</span></tt> are merged by going through the input tables in
order and taking the first value which is defined (i.e. is not None).  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col1</span> <span class="o">=</span> <span class="n">Column</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col2</span> <span class="o">=</span> <span class="n">Column</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;cm&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col3</span> <span class="o">=</span> <span class="n">Column</span><span class="p">([</span><span class="mi">3</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">col1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">col2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t3</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">col3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">])</span>  
<span class="go">WARNING: MergeConflictWarning: In merged column &#39;a&#39; the &#39;unit&#39; attribute does</span>
<span class="go">not match (cm != m).  Using m for merged output [astropy.table.operations]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">out</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>  
<span class="go">Unit(&quot;m&quot;)</span>
</pre></div>
</div>
<p>The rules for merging are as for <a class="reference internal" href="#merging-metadata">Merging metadata</a>, and the
<tt class="docutils literal"><span class="pre">metadata_conflicts</span></tt> option also controls the merging of column attributes.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Table operations</a><ul>
<li><a class="reference internal" href="#grouped-operations">Grouped operations</a><ul>
<li><a class="reference internal" href="#table-groups">Table groups</a></li>
<li><a class="reference internal" href="#manipulating-groups">Manipulating groups</a></li>
<li><a class="reference internal" href="#column-groups">Column Groups</a></li>
<li><a class="reference internal" href="#aggregation">Aggregation</a></li>
<li><a class="reference internal" href="#filtering">Filtering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stack-vertically">Stack vertically</a></li>
<li><a class="reference internal" href="#stack-horizontally">Stack horizontally</a></li>
<li><a class="reference internal" href="#join">Join</a><ul>
<li><a class="reference internal" href="#identical-keys">Identical keys</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merging-details">Merging details</a><ul>
<li><a class="reference internal" href="#column-renaming">Column renaming</a></li>
<li><a class="reference internal" href="#merging-metadata">Merging metadata</a></li>
<li><a class="reference internal" href="#merging-column-attributes">Merging column attributes</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/table/operations.rst">Edit This Page on Github</a> &nbsp;
    <a href="../_sources/table/operations.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2014, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2. &nbsp;
    Last built 29 Jul 2014. <br/>
  </p>
</footer>
  </body>
</html>