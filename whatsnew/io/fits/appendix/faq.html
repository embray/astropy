<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyFITS FAQ &mdash; Astropy v1.0.dev9586</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.dev9586',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.0.dev9586" href="../../../index.html" />
    <link rel="up" title="FITS File handling (astropy.io.fits)" href="../index.html" />
    <link rel="next" title="astropy.io.fits History" href="history.html" />
    <link rel="prev" title="Header Interface Transition Guide" href="header_transition.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  </head>
  <body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="history.html" title="astropy.io.fits History">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="header_transition.html" title="Header Interface Transition Guide">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../../index.html">Astropy v1.0.dev9586</a>
	 &raquo;
      </li>
      <li><a href="../index.html" accesskey="U">FITS File handling (<tt class="docutils literal"><span class="pre">astropy.io.fits</span></tt>)</a> &raquo;</li>
      
      <li>PyFITS FAQ</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pyfits-faq">
<h1><a class="toc-backref" href="#id3">PyFITS FAQ</a><a class="headerlink" href="#pyfits-faq" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#pyfits-faq" id="id3">PyFITS FAQ</a><ul>
<li><a class="reference internal" href="#general-questions" id="id4">General Questions</a><ul>
<li><a class="reference internal" href="#what-is-pyfits" id="id5">What is PyFITS?</a></li>
<li><a class="reference internal" href="#what-is-the-development-status-of-pyfits" id="id6">What is the development status of PyFITS?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-and-installation-questions" id="id7">Build and Installation Questions</a><ul>
<li><a class="reference internal" href="#is-pyfits-available-on-windows" id="id8">Is PyFITS available on Windows?</a></li>
<li><a class="reference internal" href="#where-is-the-windows-installer-for-version-x-of-pyfits-on-version-y-of-python" id="id9">Where is the Windows installer for version X of PyFITS on version Y of Python?</a></li>
<li><a class="reference internal" href="#why-is-the-pyfits-installation-failing-on-windows" id="id10">Why is the PyFITS installation failing on Windows?</a></li>
<li><a class="reference internal" href="#on-windows-vista-or-later-why-can-t-the-installer-find-python-in-the-registry" id="id11">On Windows Vista or later why can&#8217;t the installer find Python in the registry?</a></li>
<li><a class="reference internal" href="#how-do-i-install-pyfits-from-source-on-windows" id="id12">How do I install PyFITS from source on Windows?</a></li>
<li><a class="reference internal" href="#is-pyfits-available-for-mac-osx" id="id13">Is PyFITS available for Mac OSX?</a></li>
<li><a class="reference internal" href="#why-is-the-pyfits-installation-failing-on-osx-lion-10-7" id="id14">Why is the PyFITS installation failing on OSX Lion (10.7)?</a></li>
<li><a class="reference internal" href="#how-do-i-find-out-what-version-of-pyfits-i-have-installed" id="id15">How do I find out what version of PyFITS I have installed?</a></li>
<li><a class="reference internal" href="#how-do-i-run-the-tests-for-pyfits" id="id16">How do I run the tests for PyFITS?</a></li>
<li><a class="reference internal" href="#how-can-i-build-a-copy-of-the-pyfits-documentation-for-my-own-use" id="id17">How can I build a copy of the PyFITS documentation for my own use?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-questions" id="id18">Usage Questions</a><ul>
<li><a class="reference internal" href="#something-didn-t-work-as-i-expected-did-i-do-something-wrong" id="id19">Something didn&#8217;t work as I expected.  Did I do something wrong?</a></li>
<li><a class="reference internal" href="#pyfits-crashed-and-output-a-long-string-of-code-what-do-i-do" id="id20">PyFITS crashed and output a long string of code.  What do I do?</a></li>
<li><a class="reference internal" href="#why-does-opening-a-file-work-in-cfitsio-ds9-etc-but-not-in-pyfits" id="id21">Why does opening a file work in CFITSIO, ds9, etc. but not in PyFITS?</a></li>
<li><a class="reference internal" href="#how-do-i-turn-off-the-warning-messages-pyfits-keeps-outputting-to-my-console" id="id22">How do I turn off the warning messages PyFITS keeps outputting to my console?</a></li>
<li><a class="reference internal" href="#how-can-i-check-if-my-code-is-using-deprecated-pyfits-features" id="id23">How can I check if my code is using deprecated PyFITS features?</a></li>
<li><a class="reference internal" href="#what-convention-does-pyfits-use-for-indexing-such-as-of-image-coordinates" id="id24">What convention does PyFITS use for indexing, such as of image coordinates?</a></li>
<li><a class="reference internal" href="#how-do-i-open-a-very-large-image-that-won-t-fit-in-memory" id="id25">How do I open a very large image that won&#8217;t fit in memory?</a></li>
<li><a class="reference internal" href="#how-can-i-create-a-very-large-fits-file-from-scratch" id="id26">How can I create a very large FITS file from scratch?</a></li>
<li><a class="reference internal" href="#how-do-i-create-a-multi-extension-fits-file-from-scratch" id="id27">How do I create a multi-extension FITS file from scratch?</a></li>
<li><a class="reference internal" href="#why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats" id="id28">Why is an image containing integer data being converted unexpectedly to floats?</a></li>
<li><a class="reference internal" href="#why-am-i-losing-precision-when-i-assign-floating-point-values-in-the-header" id="id29">Why am I losing precision when I assign floating point values in the header?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="general-questions">
<h2><a class="toc-backref" href="#id4">General Questions</a><a class="headerlink" href="#general-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-pyfits">
<h3><a class="toc-backref" href="#id5">What is PyFITS?</a><a class="headerlink" href="#what-is-pyfits" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.stsci.edu/institute/software_hardware/pyfits">PyFITS</a> is a library written in, and for use with the <a class="reference external" href="http://www.python.org">Python</a> programming
language for reading, writing, and manipulating <a class="reference external" href="http://fits.gsfc.nasa.gov/">FITS</a> formatted files.  It
includes a high-level interface to FITS headers with the ability for high and
low-level manipulation of headers, and it supports reading image and table
data as <a class="reference external" href="http://numpy.scipy.org/">Numpy</a> arrays.  It also supports more obscure and non-standard formats
found in some FITS files.</p>
<p>PyFITS includes two command-line utilities for working with FITS files:
fitscheck, which can verify and write FITS checksums; and fitsdiff, which can
analyze and display the differences between two FITS files.</p>
<p>Although PyFITS is written mostly in Python, it includes an optional module
written in C that&#8217;s required to read/write compressed image data.  However,
the rest of PyFITS functions without this extension module.</p>
</div>
<div class="section" id="what-is-the-development-status-of-pyfits">
<h3><a class="toc-backref" href="#id6">What is the development status of PyFITS?</a><a class="headerlink" href="#what-is-the-development-status-of-pyfits" title="Permalink to this headline">¶</a></h3>
<p>PyFITS is written and maintained by the Science Software Branch at the <a class="reference external" href="http://www.stsci.edu/">Space
Telescope Science Institute</a>, and is licensed by <a class="reference external" href="http://www.aura-astronomy.org/">AURA</a> under a <a class="reference external" href="http://en.wikipedia.org/wiki/BSD_licenses#3-clause_license_.28.22New_BSD_License.22_or_.22Modified_BSD_License.22.29">3-clause BSD
license</a> (see <a class="reference external" href="https://trac.assembla.com/pyfits/browser/trunk/LICENSE.txt">LICENSE.txt</a> in the PyFITS source code).</p>
<p>PyFITS&#8217; current primary developer and active maintainer is <a class="reference external" href="mailto:embray&#37;&#52;&#48;stsci&#46;edu">Erik Bray</a>, though
patch submissions are welcome from anyone.  It has a <a class="reference external" href="https://trac.assembla.com/pyfits/">Trac site</a> where the
source code can be browsed, and where bug reports may be submitted.  The source
code resides primarily in an <a class="reference external" href="https://subversion.assembla.com/svn/pyfits/">SVN repository</a> which allows anonymous
checkouts, though a <a class="reference external" href="git://github.com/spacetelescope/PyFITS.git">Git mirror</a> also exists.  PyFITS also has a <a class="reference external" href="https://github.com/spacetelescope/PyFITS">GitHub
site</a>.</p>
<p>The current stable release series is 3.0.x.  Each 3.0.x release tries to
contain only bug fixes, and to not introduce any significant behavioral or API
changes (though this isn&#8217;t guaranteed to be perfect).  The upcoming 3.1 release
will contain new features and some API changes, though will try maintain as
much backwards-compatibility as possible.  After the 3.1 release there may be
further 3.0.x releases for bug fixes only where possible.  Older versions of
PyFITS (2.4 and earlier) are no longer actively supported.</p>
<p>PyFITS is also included as a major component of upcoming <a class="reference external" href="http://astropy.org">Astropy</a> project as
the <a class="reference internal" href="../index.html#module-astropy.io.fits" title="astropy.io.fits"><tt class="xref py py-mod docutils literal"><span class="pre">astropy.io.fits</span></tt></a> module.  The goal is for Astropy to eventually serve
as a drop-in replacement for PyFITS. However, for the time being PyFITS will
still be released as an independent product as well, until such time that the
Astropy project proves successful and widely-adopted.</p>
</div>
</div>
<div class="section" id="build-and-installation-questions">
<h2><a class="toc-backref" href="#id7">Build and Installation Questions</a><a class="headerlink" href="#build-and-installation-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="is-pyfits-available-on-windows">
<h3><a class="toc-backref" href="#id8">Is PyFITS available on Windows?</a><a class="headerlink" href="#is-pyfits-available-on-windows" title="Permalink to this headline">¶</a></h3>
<p>Yes&#8211;the majority of PyFITS is pure Python, and can be installed and used on
any platform that supports Python (&gt;=2.5).  However, PyFITS includes an
optional C extension module for reading/writing compressed image HDUs.  As most
Windows systems are not configured to compile C source code, binary installers
are also available for Windows.  Though PyFITS can also be installed from
source even on Windows systems without a compiler by disabling the compression
module.  See <a class="reference internal" href="#how-do-i-install-pyfits-from-source-on-windows">How do I install PyFITS from source on Windows?</a> for more
details.</p>
</div>
<div class="section" id="where-is-the-windows-installer-for-version-x-of-pyfits-on-version-y-of-python">
<h3><a class="toc-backref" href="#id9">Where is the Windows installer for version X of PyFITS on version Y of Python?</a><a class="headerlink" href="#where-is-the-windows-installer-for-version-x-of-pyfits-on-version-y-of-python" title="Permalink to this headline">¶</a></h3>
<p>Every official PyFITS build for Windows is eventually uploaded to <a class="reference external" href="http://pypi.python.org/pypi/pyfits">PyPI</a>.  This
includes builds for every major Python release from 2.5.x and up, except for
3.0 as there is no official Numpy release for Python 3.0 on Windows.  The one
binary module included in these builds was linked with Numpy 1.6.1, though it
should work with other recent Numpy versions.</p>
<p>Sometimes the Windows binary installers don&#8217;t go up immediately after every
PyFITS release.  But if they appear missing they should go up within another
business day or two.  This has gotten better with recent releases thanks to
some automation.</p>
</div>
<div class="section" id="why-is-the-pyfits-installation-failing-on-windows">
<h3><a class="toc-backref" href="#id10">Why is the PyFITS installation failing on Windows?</a><a class="headerlink" href="#why-is-the-pyfits-installation-failing-on-windows" title="Permalink to this headline">¶</a></h3>
<p>The most likely cause of installation failure on Windows is if building/
installing from source fails due to the lack of a compiler for the optional C
extension module.  Such a failure would produce an error that looks something
like:</p>
<div class="highlight-python"><div class="highlight"><pre>building &#39;pyfits.compression&#39; extension
error: Unable to find vcvarsall.bat
</pre></div>
</div>
<p>Your best bet in cases like this is to install from one of the binary
executable installers available for Windows on PyPI.  However, there are still
cases where you may need to install from source: For example, it&#8217;s difficult to
use the binary installers with virtualenv.  See <a class="reference internal" href="#how-do-i-install-pyfits-from-source-on-windows">How do I install PyFITS from
source on Windows?</a> for more detailed instructions on building on Windows.</p>
<p>See below for a few answers to other specific questions about Windows
installation. For other installation errors not mentioned by this FAQ, please
contact <a class="reference external" href="mailto:help&#37;&#52;&#48;stsci&#46;edu">help<span>&#64;</span>stsci<span>&#46;</span>edu</a> with a description of the problem.</p>
</div>
<div class="section" id="on-windows-vista-or-later-why-can-t-the-installer-find-python-in-the-registry">
<h3><a class="toc-backref" href="#id11">On Windows Vista or later why can&#8217;t the installer find Python in the registry?</a><a class="headerlink" href="#on-windows-vista-or-later-why-can-t-the-installer-find-python-in-the-registry" title="Permalink to this headline">¶</a></h3>
<p>This is a common issue with Windows installers for Python packages that do not
support the new User Access Control (UAC) framework added in Windows Vista and
later.  In particular, when a Python is installed &#8220;for all users&#8221; (as opposed
to for a single user) it adds entries for that Python installation under the
<tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt> (HKLM) hierarchy and <em>not</em> under the
<tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt> (HKCU) hierarchy.  However, depending on your UAC
settings, if the PyFITS installer is not executed with elevated privileges
it will not be able to check in HKLM for the required information about your
Python installation.</p>
<p>In short: If you encounter this problem it&#8217;s because you need the appropriate
entries in the Windows registry for Python. You can download <a class="reference external" href="https://gist.github.com/embray/6042780#file-win_register_python-py">this script</a>
and execute it with the same Python as the one you want to install PyFITS
into.  For example to add the missing registry entries to your Python 2.7:</p>
<div class="highlight-python"><div class="highlight"><pre>C:\&gt;C:\Python27\python.exe C:\Path\To\Downloads\win_register_python.py
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-install-pyfits-from-source-on-windows">
<h3><a class="toc-backref" href="#id12">How do I install PyFITS from source on Windows?</a><a class="headerlink" href="#how-do-i-install-pyfits-from-source-on-windows" title="Permalink to this headline">¶</a></h3>
<p>There are a few options for building/installing PyFITS from source on Windows.</p>
<p>First of all, as mentioned elsewhere, most of PyFITS is pure-Python.  Only the
C extension module for reading/writing compressed images needs to be compiled.
If you don&#8217;t need compressed image support, PyFITS can be installed without it.</p>
<p>In future releases this will hopefully be even easier, but for now it&#8217;s
necessary to edit one file in order to disable the extension module.  Locate
the <a class="reference external" href="https://trac.assembla.com/pyfits/browser/trunk/setup.cfg">setup.cfg</a> file at the root of the PyFITS source code.  This is the file
that describes what needs to be installed for PyFITS.  Find the line that reads
<tt class="docutils literal"><span class="pre">[extension=pyfits.compression]</span></tt>.  This is the section that lists what needs
to be compiled for the extension module.  Comment out every line in the
extension section by prepending it with a <tt class="docutils literal"><span class="pre">#</span></tt> character (stopping at the
<tt class="docutils literal"><span class="pre">[build_ext]</span></tt> line).  It should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">...</span>
<span class="n">scripts</span> <span class="o">=</span> <span class="n">scripts</span><span class="o">/</span><span class="n">fitscheck</span>

<span class="c">#[extension=pyfits.compression]</span>
<span class="c">#sources =</span>
<span class="c">#    src/compress.c</span>
<span class="c">#    src/fits_hcompress.c</span>
<span class="c">#    src/fits_hdecompress.c</span>
<span class="c">#    src/fitsio.c</span>
<span class="c">#    src/pliocomp.c</span>
<span class="c">#    src/compressionmodule.c</span>
<span class="c">#    src/quantize.c</span>
<span class="c">#    src/ricecomp.c</span>
<span class="c">#    src/zlib.c</span>
<span class="c">#    src/inffast.c</span>
<span class="c">#    src/inftrees.c</span>
<span class="c">#    src/trees.c</span>
<span class="c">#include_dirs = numpy</span>
<span class="c"># Squelch a handful of warnings (which actually cause pip to break in tox and</span>
<span class="c"># other environments due to gcc outputting non-ASCII characters in some</span>
<span class="c"># terminals; see python issue6135)</span>
<span class="c">#extra_compile_args =</span>
<span class="c">#    -Wno-unused-function</span>
<span class="c">#    -Wno-strict-prototypes</span>

<span class="p">[</span><span class="n">build_ext</span><span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>With these lines properly commented out, rerun <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt>, and
it should skip building/installing the compression module.  PyFITS will work
fine with out it, but will issue warnings when encountering a compressed image
that it can&#8217;t read.</p>
<p>If you do need to compile the compression module, this can still be done on
Windows with just a little extra work.  By default, Python tries to compile
extension modules with the same compiler that Python itself was compiled with.</p>
<p>To check what compiler Python was built with, the easiest way is to run:</p>
<div class="highlight-python"><div class="highlight"><pre>python -c &quot;import platform; print platform.python_compiler()&quot;
</pre></div>
</div>
<p>For the official builds of recent Python versions this should be something
like:</p>
<div class="highlight-python"><div class="highlight"><pre>MSC v.1500 32 bit (Intel)
</pre></div>
</div>
<p>For unofficial Windows distributions of Python, such as ActiveState, EPD, or
Cygwin, your mileage may vary.</p>
<p>As it so happens, MSC v.15xx is the compiler version included with Visual
C++ 2008.  Luckily, Microsoft distributes a free version of this as <a class="reference external" href="http://www.microsoft.com/visualstudio/en-us/products/2008-editions/express">Visual C++
Express Edition</a>.  So for building Python extension modules on Windows this is
one of the simpler routes.  Just install the free VC++ 2008.  It should install
a link to the Start Menu at All Programs-&gt;Microsoft Visual C++ Express
Edition-&gt;Visual Studio Tools-&gt;Visual Studio 2008 Command Prompt.</p>
<p>If you run that link, it should launch a command prompt with reasonable
environment variables set up for using Visual C++.  Then change directories to
your copy of the PyFITS source code and re-run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt>.
You may also need to comment out the <tt class="docutils literal"><span class="pre">extra_compile_args</span></tt> option in the
<tt class="docutils literal"><span class="pre">setup.cfg</span></tt> file (its value is the two lines under it after the equal sign).
Though the need to manually disable this option for MSC will be fixed in a
future PyFITS version.</p>
<p>Another option is to use gcc through <a class="reference external" href="http://www.mingw.org/">MinGW</a>, which is in fact how the PyFITS
releases for Windows are currently built.  This article provides a good
overview of how to set this up: <a class="reference external" href="http://seewhatever.de/blog/?p=217">http://seewhatever.de/blog/?p=217</a></p>
</div>
<div class="section" id="is-pyfits-available-for-mac-osx">
<h3><a class="toc-backref" href="#id13">Is PyFITS available for Mac OSX?</a><a class="headerlink" href="#is-pyfits-available-for-mac-osx" title="Permalink to this headline">¶</a></h3>
<p>Yes, but there is no binary package specifically for OSX (such as a .dmg, for
example).  For OSX just download, build, and install the source package.  This
is generally easier on OSX than it is on Windows, thanks to the more
developer-friendly environment.</p>
<p>The only major problem with building on OSX seems to occur for some users of
10.7 Lion, with misconfigured systems.  See the next question for details on
that.</p>
<p>To build PyFITS without the optional compression module, follow the
instructions in <a class="reference internal" href="#how-do-i-install-pyfits-from-source-on-windows">How do I install PyFITS from source on Windows?</a>.</p>
</div>
<div class="section" id="why-is-the-pyfits-installation-failing-on-osx-lion-10-7">
<h3><a class="toc-backref" href="#id14">Why is the PyFITS installation failing on OSX Lion (10.7)?</a><a class="headerlink" href="#why-is-the-pyfits-installation-failing-on-osx-lion-10-7" title="Permalink to this headline">¶</a></h3>
<p>There is a common problem that affects all Python packages with C extension
modules (not just PyFITS) for some users of OSX 10.7.  What usually occurs is
that when building the package several errors will be output, ending with
something like:</p>
<div class="highlight-python"><div class="highlight"><pre>unable to execute gcc-4.2: No such file or directory
error: command &#39;gcc-4.2&#39; failed with exit status 1
</pre></div>
</div>
<p>There are a few other errors like it that can occur.  The problem is that when
you build a C extension, by default it will try to use the same compiler that
your Python was built with. In this case, since you&#8217;re using the 32-bit
universal build of Python it&#8217;s trying to use the older gcc-4.2 and is trying
to build with PPC support, which is no longer supported in Xcode.</p>
<p>In this case the best solution is to install the x86-64 build of Python for
OSX (<a class="reference external" href="http://www.python.org/ftp/python/2.7.2/python-2.7.2-macosx10.6.dmg">http://www.python.org/ftp/python/2.7.2/python-2.7.2-macosx10.6.dmg</a> for
2.7.2).  In fact, this is the build version officially supported for use on
Lion.  Other, unofficial Python builds such as from <a class="reference external" href="http://astrofrog.github.com/macports-python/">MacPorts</a> may also work.</p>
</div>
<div class="section" id="how-do-i-find-out-what-version-of-pyfits-i-have-installed">
<h3><a class="toc-backref" href="#id15">How do I find out what version of PyFITS I have installed?</a><a class="headerlink" href="#how-do-i-find-out-what-version-of-pyfits-i-have-installed" title="Permalink to this headline">¶</a></h3>
<p>To output the PyFITS version from the command line, run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python -c &#39;import pyfits; print(pyfits.__version__)&#39;
</pre></div>
</div>
<p>When PyFITS is installed with stsci_python, it is also possible to check the
installed SVN revision by importing <tt class="docutils literal"><span class="pre">pyfits.svn_version</span></tt>.  Then use
<tt class="docutils literal"><span class="pre">dir(pyfits.svn_version)</span></tt> to view a list of available attributes.  A
feature like this will be available soon in standalone versions of PyFITS as
well.</p>
</div>
<div class="section" id="how-do-i-run-the-tests-for-pyfits">
<h3><a class="toc-backref" href="#id16">How do I run the tests for PyFITS?</a><a class="headerlink" href="#how-do-i-run-the-tests-for-pyfits" title="Permalink to this headline">¶</a></h3>
<p>Currently the best way to run the PyFITS tests is to download the source code,
either from a source release or from version control, and to run the tests out
of the source.  It is not necessary to install PyFITS to run the tests out of
the source code.</p>
<p>The PyFITS tests require <a class="reference external" href="http://readthedocs.org/docs/nose/en/latest/">nose</a> to run.  nose can be installed on any Python
version using pip or easy_install.  See the nose documentation for more
details.</p>
<p>With nose installed, it is simple to run the tests on Python 2.x:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python setup.py nosetests
</pre></div>
</div>
<p>If PyFITS has not already been built, this will build it automatically, then
run the tests.  This does not cause PyFITS to be installed.</p>
<p>On Python 3.x the situation is a little more complicated.  This is due to the
fact that PyFITS&#8217; source code is not Python 3-compatible out of the box, but
has to be run through the 2to3 converter.  Normally when you build/install
PyFITS on Python 3.x, the 2to3 conversion is performed automatically.
Unfortunately, nose does not know to use the 2to3&#8217;d source code, and will
instead try to import and test the unconverted source code.</p>
<p>To work around this, it is necessary to first build PyFITS (which will run the
source through 2to3):</p>
<div class="highlight-python"><div class="highlight"><pre>$ python setup.py build
</pre></div>
</div>
<p>Then run the <tt class="docutils literal"><span class="pre">nosetests</span></tt> command, but pointing it to the <tt class="docutils literal"><span class="pre">build</span></tt> tree
where the 2to3&#8217;d source code and tests reside, using the <tt class="docutils literal"><span class="pre">-w</span></tt> switch:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python setup.py nosetests -w build/lib.linux-x86_64-3.2
</pre></div>
</div>
<p>where the exact path of the <tt class="docutils literal"><span class="pre">build/lib.*</span></tt> directory will vary depending on
your platform and Python version.</p>
</div>
<div class="section" id="how-can-i-build-a-copy-of-the-pyfits-documentation-for-my-own-use">
<h3><a class="toc-backref" href="#id17">How can I build a copy of the PyFITS documentation for my own use?</a><a class="headerlink" href="#how-can-i-build-a-copy-of-the-pyfits-documentation-for-my-own-use" title="Permalink to this headline">¶</a></h3>
<p>First of all, it&#8217;s worth pointing out that the documentation for the latest
version of PyFITS can always be downloaded in <a class="reference external" href="http://stsdas.stsci.edu/download/docs/The_PyFITS_Handbook.pdf">PDF form</a> or browsed
online in <a class="reference external" href="http://packages.python.org/pyfits">HTML</a>.  There are also plans
to make the docs for older versions of PyFITS, as well as up-to-date
development docs available online.</p>
<p>Otherwise, to build your own version of the docs either for offline use, or to
build the development version of the docs there are a few requirements.  The
most import requirement is <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a>, which is the toolkit used to generate
the documentation.  Use <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sphinx</span></tt> or <tt class="docutils literal"><span class="pre">easy_install</span> <span class="pre">sphinx</span></tt> to
install Sphinx.  Using pip or easy_install will install the correct versions
of Sphinx&#8217;s basic dependencies, which include docutils, Jinja2, and Pygments.</p>
<p>Next, the docs require STScI&#8217;s custom Sphinx theme, <a class="reference external" href="http://pypi.python.org/pypi/stsci.sphinxext">stsci.sphinxext</a>.  It&#8217;s
a simple pure-Python package and can be installed with pip or easy_install.</p>
<p>The next requirement is <a class="reference external" href="http://pypi.python.org/pypi/numpydoc">numpydoc</a>, which is not normally installed with
Numpy itself.  Install it with pip or easy_install.  Numpy is also required,
though it is of course a requirement of PyFITS itself.</p>
<p>Finally, it is necessary to have <a class="reference external" href="http://matplotlib.sourceforge.net/">matplotlib</a>, specifically for
matplotlib.sphinxext.  This is perhaps the most onerous requirement if you do
not already have it installed. Please refer to the matplotlib documentation for
details on downloading and installing matplotlib.</p>
<p>It is also necessary to install PyFITS itself in order to generate the API
documentation.  For this reason, it is a good idea to install Sphinx and
PyFITS into a <a class="reference external" href="http://pypi.python.org/pypi/virtualenv">virtualenv</a> in order to build the development version of the
docs (see below).</p>
<p>With all the requirements installed, change directories into the <tt class="docutils literal"><span class="pre">docs/</span></tt>
directory in the PyFITS source code, and run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ make html
</pre></div>
</div>
<p>to build the HTML docs, which will be output to <tt class="docutils literal"><span class="pre">build/html</span></tt>.  To build the
docs in other formats, please refer to the Sphinx documentation.</p>
<p>To summarize, assuming that you already have Numpy and Matplotlib on your
Python installation, perform the following steps from within the PyFITS source
code:</p>
<div class="highlight-python"><div class="highlight"><pre>$ virtualenv --system-site-packages pyfits-docs
$ source pyfits-docs/bin/activate
$ pip install sphinx
$ pip install numpydoc
$ pip install stsci.sphinxext
$ python setup.py install pyfits
$ cd docs/
$ make html
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage-questions">
<h2><a class="toc-backref" href="#id18">Usage Questions</a><a class="headerlink" href="#usage-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="something-didn-t-work-as-i-expected-did-i-do-something-wrong">
<h3><a class="toc-backref" href="#id19">Something didn&#8217;t work as I expected.  Did I do something wrong?</a><a class="headerlink" href="#something-didn-t-work-as-i-expected-did-i-do-something-wrong" title="Permalink to this headline">¶</a></h3>
<p>Possibly.  But if you followed the documentation and things still did not work
as expected, it is entirely possible that there is a mistake in the
documentation, a bug in the code, or both.  So feel free to report it as a
bug.  There are also many, many corner cases in FITS files, with new ones
discovered almost every week.  PyFITS is always improving, but does not
support all cases perfectly.  There are some features of the FITS format
(scaled data, for example) that are difficult to support correctly and can
sometimes cause unexpected behavior.</p>
<p>For the most common cases, however, such as reading and updating FITS headers,
images, and tables, PyFITS should be very stable and well-tested.  Before
every PyFITS release it is ensured that all its tests pass on a variety of
platforms, and those tests cover the majority of use-cases (until new
corner cases are discovered).</p>
</div>
<div class="section" id="pyfits-crashed-and-output-a-long-string-of-code-what-do-i-do">
<h3><a class="toc-backref" href="#id20">PyFITS crashed and output a long string of code.  What do I do?</a><a class="headerlink" href="#pyfits-crashed-and-output-a-long-string-of-code-what-do-i-do" title="Permalink to this headline">¶</a></h3>
<p>This listing of code is what is knows as a <a class="reference external" href="http://en.wikipedia.org/wiki/Stack_trace">stack trace</a> (or in Python
parlance a &#8220;traceback&#8221;).  When an unhandled exception occurs in the code,
causing the program to end, this is a way of displaying where the exception
occurred and the path through the code that led to it.</p>
<p>As PyFITS is meant to be used as a piece in other software projects, some
exceptions raised by PyFITS are by design.  For example, one of the most
common exceptions is a <a class="reference external" href="http://docs.python.org/library/exceptions.html#exceptions.KeyError" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">KeyError</span></tt></a> when an attempt is made to
read the value of a non-existent keyword in a header:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyfits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="s">&#39;NAXIS&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;/path/to/pyfits/header.py&quot;</span>, line <span class="m">125</span>, in <span class="n">__getitem__</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cardindex</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span>
  File <span class="nb">&quot;/path/to/pyfits/header.py&quot;</span>, line <span class="m">1535</span>, in <span class="n">_cardindex</span>
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Keyword </span><span class="si">%r</span><span class="s"> not found.&quot;</span> <span class="o">%</span> <span class="n">keyword</span><span class="p">)</span>
<span class="gr">KeyError</span>: <span class="n">&quot;Keyword &#39;NAXIS&#39; not found.&quot;</span>
</pre></div>
</div>
<p>This indicates that something was looking for a keyword called &#8220;NAXIS&#8221; that
does not exist.  If an error like this occurs in some other software that uses
PyFITS, it may indicate a bug in that software, in that it expected to find a
keyword that didn&#8217;t exist in a file.</p>
<p>Most &#8220;expected&#8221; exceptions will output a message at the end of the traceback
giving some idea of why the exception occurred and what to do about it.  The
more vague and mysterious the error message in an exception appears, the more
likely that it was caused by a bug in PyFITS.  So if you&#8217;re getting an
exception and you really don&#8217;t know why or what to do about it, feel free to
report it as a bug.</p>
</div>
<div class="section" id="why-does-opening-a-file-work-in-cfitsio-ds9-etc-but-not-in-pyfits">
<h3><a class="toc-backref" href="#id21">Why does opening a file work in CFITSIO, ds9, etc. but not in PyFITS?</a><a class="headerlink" href="#why-does-opening-a-file-work-in-cfitsio-ds9-etc-but-not-in-pyfits" title="Permalink to this headline">¶</a></h3>
<p>As mentioned elsewhere in this FAQ, there are many unusual corner cases when
dealing with FITS files.  It&#8217;s possible that a file should work, but isn&#8217;t
support due to a bug.  Sometimes it&#8217;s even possible for a file to work in an
older version of PyFITS, but not a newer version due to a regression that
isn&#8217;t tested for yet.</p>
<p>Another problem with the FITS format is that, as old as it is, there are many
conventions that appear in files from certain sources that do not meet the
FITS standard.  And yet they are so common-place that it is necessary to
support them in any FITS readers.  CONTINUE cards are one such example.  There
are non-standard conventions supported by PyFITS that are not supported by
CFITSIO and vice-versa.  You may have hit one of those cases.</p>
<p>If PyFITS is having trouble opening a file, a good way to rule out whether not
the problem is with PyFITS is to run the file through the <a class="reference external" href="http://heasarc.gsfc.nasa.gov/docs/software/ftools/fitsverify/">fitsverify</a>.  For
smaller files you can even use the <a class="reference external" href="http://fits.gsfc.nasa.gov/fits_verify.html">online FITS verifier</a>.  These use CFITSIO
under the hood, and should give a good indication of whether or not there is
something erroneous about the file.  If the file is malformatted, fitsverify
will output errors and warnings.</p>
<p>If fitsverify confirms no problems with a file, and PyFITS is still having
trouble opening it (especially if it produces a traceback) then it&#8217;s likely
there is a bug in PyFITS.</p>
</div>
<div class="section" id="how-do-i-turn-off-the-warning-messages-pyfits-keeps-outputting-to-my-console">
<h3><a class="toc-backref" href="#id22">How do I turn off the warning messages PyFITS keeps outputting to my console?</a><a class="headerlink" href="#how-do-i-turn-off-the-warning-messages-pyfits-keeps-outputting-to-my-console" title="Permalink to this headline">¶</a></h3>
<p>PyFITS uses Python&#8217;s built-in <a class="reference external" href="http://docs.python.org/library/warnings.html">warnings</a> subsystem for informing about
exceptional conditions in the code that are recoverable, but that the user may
want to be informed of.  One of the most common warnings in PyFITS occurs when
updating a header value in such a way that the comment must be truncated to
preserve space:</p>
<div class="highlight-python"><div class="highlight"><pre>Card is too long, comment is truncated.
</pre></div>
</div>
<p>Any console output generated by PyFITS can be assumed to be from the warnings
subsystem.  Fortunately there are two easy ways to quiet these warnings:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Using the <a class="reference external" href="http://docs.python.org/using/cmdline.html#cmdoption-W">-W option</a> to the <tt class="docutils literal"><span class="pre">python</span></tt> executable.  Just start Python
like:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python -Wignore &lt;scriptname&gt;
</pre></div>
</div>
<p>or for short:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python -Wi &lt;scriptname&gt;
</pre></div>
</div>
<p>and all warning output will be silenced.</p>
</li>
<li><p class="first">Warnings can be silenced programatically from anywhere within a script.
For example, to disable all warnings in a script, add something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Another option, instead of <tt class="docutils literal"><span class="pre">ignore</span></tt> is <tt class="docutils literal"><span class="pre">once</span></tt>, which causes any warning
to be output only once within the session, rather than repeatedly (such as in
a loop).  There are many more ways to filter warnings with <tt class="docutils literal"><span class="pre">-W</span></tt> and the
warnings module.  For example, it is possible to silence only specific
warning messages.  Please refer to the Python documentation for more details,
or ask at <a class="reference external" href="mailto:help&#37;&#52;&#48;stsci&#46;edu">help<span>&#64;</span>stsci<span>&#46;</span>edu</a>.</p>
</div></blockquote>
</div>
<div class="section" id="how-can-i-check-if-my-code-is-using-deprecated-pyfits-features">
<h3><a class="toc-backref" href="#id23">How can I check if my code is using deprecated PyFITS features?</a><a class="headerlink" href="#how-can-i-check-if-my-code-is-using-deprecated-pyfits-features" title="Permalink to this headline">¶</a></h3>
<p>PyFITS 3.0 included a major reworking of the code and some of the APIs.  Most
of the differences are just renaming functions to use a more consistent naming
scheme.  For example the <tt class="docutils literal"><span class="pre">createCard()</span></tt> function was renamed to
<tt class="docutils literal"><span class="pre">create_card()</span></tt> for consistency with a <tt class="docutils literal"><span class="pre">lower_case_underscore</span></tt> naming
scheme for functions.</p>
<p>There are a few other functions and attributes that were deprecated either
because they were renamed to something simpler or more consistent, or because
they were redundant or replaced.</p>
<p>Eventually all deprecated features will be removed in future PyFITS versions
(though there will be significant warnings in advance).  It is best to check
whether your code is using deprecated features sooner rather than later.</p>
<p>On Python 2.5, all deprecation warnings are displayed by default, so you may
have already discovered them.  However, on Python 2.6 and up, deprecation
warnings are <em>not</em> displayed by default.  To show all deprecation warnings,
start Python like:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python -Wd &lt;scriptname&gt;
</pre></div>
</div>
<p>Most deprecation issues can be fixed with a simple find/replace.  The warnings
displayed will let you know how to replace the old interface.</p>
<p>If you have a lot of old code that was written for older versions of PyFITS it
would be worth doing this.  PyFITS 3.1 introduces a significant rewrite of the
Header interface, and contains even more deprecations.</p>
</div>
<div class="section" id="what-convention-does-pyfits-use-for-indexing-such-as-of-image-coordinates">
<h3><a class="toc-backref" href="#id24">What convention does PyFITS use for indexing, such as of image coordinates?</a><a class="headerlink" href="#what-convention-does-pyfits-use-for-indexing-such-as-of-image-coordinates" title="Permalink to this headline">¶</a></h3>
<p>All arrays and sequences in PyFITS use a zero-based indexing scheme.  For
example, the first keyword in a header is <tt class="docutils literal"><span class="pre">header[0]</span></tt>, not <tt class="docutils literal"><span class="pre">header[1]</span></tt>.
This is in accordance with Python itself, as well as C, on which PyFITS is
based.</p>
<p>This may come as a surprise to veteran FITS users coming from IRAF, where
1-based indexing is typically used, due to its origins in FORTRAN.</p>
<p>Likewise, the top-left pixel in an N x N array is <tt class="docutils literal"><span class="pre">data[0,0]</span></tt>.  The indices
for 2-dimensional arrays are row-major order, in that the first index is the
row number, and the second index is the column number.  Or put in terms of
axes, the first axis is the y-axis, and the second axis is the x-axis.  This is
the opposite of column-major order, which is used by FORTRAN and hence FITS.
For example, the second index refers to the axis specified by NAXIS1 in the
FITS header.</p>
<p>In general, for N-dimensional arrays, row-major orders means that the
right-most axis is the one that varies the fastest while moving over the
array data linearly.  For example, the 3-dimensional array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
 <span class="p">[[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]]</span>
</pre></div>
</div>
<p>is represented linearly in row-major order as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
<p>Since 2 immediately follows 1, you can see that the right-most (or inner-most)
axis is the one that varies the fastest.</p>
<p>The discrepancy in axis-ordering may take some getting used to, but it is a
necessary evil.  Since most other Python and C software assumes row-major
ordering, trying to enforce column-major ordering in arrays returned by PyFITS
is likely to cause more difficulties than it&#8217;s worth.</p>
</div>
<div class="section" id="how-do-i-open-a-very-large-image-that-won-t-fit-in-memory">
<h3><a class="toc-backref" href="#id25">How do I open a very large image that won&#8217;t fit in memory?</a><a class="headerlink" href="#how-do-i-open-a-very-large-image-that-won-t-fit-in-memory" title="Permalink to this headline">¶</a></h3>
<p>Prior to PyFITS 3.1, when the data portion of an HDU is accessed, the data is
read into memory in its entirety.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;myimage.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>reads the entire image array from disk into memory.  For very large images or
tables this is clearly undesirable, if not impossible given the available
resources.</p>
<p>However, <tt class="docutils literal"><span class="pre">pyfits.open()</span></tt> has an option to access the data portion of an HDU
by memory mapping using <a class="reference external" href="http://en.wikipedia.org/wiki/Mmap">mmap</a>.  What this means is that accessing the data
as in the example above only reads portions of the data into memory on demand.
For example, if I request just a slice of the image, such as
<tt class="docutils literal"><span class="pre">hdul[0].data[100:200]</span></tt>, then just rows 100-200 will be read into memory.
This happens transparently, as though the entire image were already in memory.
This works the same way for tables.  For most cases this is your best bet for
working with large files.</p>
<p>To use memory mapping, just add the <tt class="docutils literal"><span class="pre">memmap=True</span></tt> argument to
<tt class="docutils literal"><span class="pre">pyfits.open()</span></tt>.</p>
<p>In PyFITS 3.1, the mmap support is improved enough that <tt class="docutils literal"><span class="pre">memmap=True</span></tt> is the
default for all <tt class="docutils literal"><span class="pre">pyfits.open()</span></tt> calls.  The default can also be controlled
through an environment variable called <tt class="docutils literal"><span class="pre">PYFITS_USE_MEMMAP</span></tt>.  Setting this to
<tt class="docutils literal"><span class="pre">0</span></tt> will disable mmap by default.</p>
<p>Unfortunately, memory mapping does not currently work as well with scaled
image data, where BSCALE and BZERO factors need to be applied to the data to
yield physical values.  Currently this requires enough memory to hold the
entire array, though this is an area that will see improvement in the future.</p>
<p>An alternative, which currently only works for image data (that is,
non-tables) is the sections interface.  It is largely replaced by the better
support for memmap, but may still be useful on systems with more limited
virtual-memory space, such as on 32-bit systems.  Support for scaled image
data is flakey with sections too, though that will be fixed.  See <a class="reference external" href="http://packages.python.org/pyfits/users_guide/users_image.html#data-section">the PyFITS
documentation</a>
for more details on working with sections.</p>
</div>
<div class="section" id="how-can-i-create-a-very-large-fits-file-from-scratch">
<h3><a class="toc-backref" href="#id26">How can I create a very large FITS file from scratch?</a><a class="headerlink" href="#how-can-i-create-a-very-large-fits-file-from-scratch" title="Permalink to this headline">¶</a></h3>
<p>This is a very common issue, but unfortunately PyFITS does not come with any
built-in facilities for creating large files (larger than will fit in memory)
from scratch (though it may in the future).</p>
<p>Normally to create a single image FITS file one would do something like:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt;&gt; data = numpy.zeros((40000, 40000), dtype=numpy.float64)
&gt;&gt; hdu = pyfits.PrimaryHDU(data=data)
&gt;&gt; hdu.writeto(&#39;large.fits&#39;)
</pre></div>
</div>
<p>However, a 40000 x 40000 array of doubles is nearly twelve gigabytes!  Most
systems won&#8217;t be able to create that in memory just to write out to disk.  In
order to create such a large file efficiently requires a little extra work,
and a few assumptions.</p>
<p>First, it is helpful to anticipate about how large (as in, how many keywords)
the header will have in it.  FITS headers must be written in 2880 byte
blocks&#8211;large enough for 36 keywords per block (including the END keyword in
the final block).  Typical headers have somewhere between 1 and 4 blocks,
though sometimes more.</p>
<p>Since the first thing we write to a FITS file is the header, we want to write
enough header blocks so that there is plenty of padding in which to add new
keywords without having to resize the whole file.  Say you want the header to
use 4 blocks by default.  Then, excluding the END card which PyFITS will add
automatically, create the header and pad it out to 36 * 4 cards like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="go"># This is a stub array that we&#39;ll be using the initialize the HDU; its</span>
<span class="go"># exact size is irrelevant, as long as it has the desired number of</span>
<span class="go"># dimensions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">36</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>  <span class="c"># Adds a blank card to the end</span>
</pre></div>
</div>
<p>Now adjust the NAXISn keywords to the desired size of the array, and write
<em>only</em> the header out to a file.  Using the <tt class="docutils literal"><span class="pre">hdu.writeto()</span></tt> method will
cause PyFITS to &#8220;helpfully&#8221; reset the NAXISn keywords to match the size of the
dummy array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">header</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="s">&#39;large.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we need to grow out the end of the file to match the length of the
data (plus the length of the header).  This can be done very efficiently on
most systems by seeking past the end of the file and writing a single byte,
like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;large.fits&#39;</span><span class="p">,</span> <span class="s">&#39;rb+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span> <span class="o">+</span> <span class="p">(</span><span class="mi">40000</span> <span class="o">*</span> <span class="mi">40000</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c"># The -1 is to account for the final byte that we are about to</span>
<span class="gp">... </span>    <span class="c"># write</span>
<span class="gp">... </span>    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>On modern operating systems this will cause the file (past the header) to be
filled with zeros out to the ~12GB needed to hold a 40000 x 40000 image.  On
filesystems that support sparse file creation (most Linux filesystems, but not
HFS+) this is a very fast, efficient operation.  On other systems your mileage
may vary.</p>
<p>This isn&#8217;t the only way to build up a large file, but probably one of the
safest.  This method can also be used to create large multi-extension FITS
files, with a little care.</p>
<p>For creating very large tables, this method may also be used.  Though it can
be difficult to determine ahead of time how many rows a table will need.  In
general, use of PyFITS is discouraged for the creation and manipulation of
large tables.  The FITS format itself is not designed for efficient on-disk or
in-memory manipulation of table structures.  For large, heavy-duty table data
it might be better too look into using <a class="reference external" href="http://www.hdfgroup.org/HDF5/">HDF5</a> through the <a class="reference external" href="http://www.pytables.org/moin">PyTables</a>
library.</p>
<p>PyTables makes use of Numpy under the hood, and can be used to write binary
table data to disk in the same format required by FITS.  It is then possible
to serialize your table to the FITS format for distribution.  At some point
this FAQ might provide an example of how to do this.</p>
</div>
<div class="section" id="how-do-i-create-a-multi-extension-fits-file-from-scratch">
<h3><a class="toc-backref" href="#id27">How do I create a multi-extension FITS file from scratch?</a><a class="headerlink" href="#how-do-i-create-a-multi-extension-fits-file-from-scratch" title="Permalink to this headline">¶</a></h3>
<p>When you open a FITS file with <tt class="docutils literal"><span class="pre">pyfits.open()</span></tt>, a <tt class="docutils literal"><span class="pre">pyfits.HDUList</span></tt> object
is returned, which holds all the HDUs in the file.  This <tt class="docutils literal"><span class="pre">HDUList</span></tt> class is
a subclass of Python&#8217;s builtin <tt class="docutils literal"><span class="pre">list</span></tt>, and can be created from scratch and
used as such:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new_hdul</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_hdul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyfits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_hdul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyfits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_hdul</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s">&#39;test.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>That will create a new multi-extension FITS file with two empty IMAGE
extensions (a default PRIMARY HDU is prepended automatically if one was not
provided manually).</p>
</div>
<div class="section" id="why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats">
<h3><a class="toc-backref" href="#id28">Why is an image containing integer data being converted unexpectedly to floats?</a><a class="headerlink" href="#why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats" title="Permalink to this headline">¶</a></h3>
<p>If the header for your image contains non-trivial values for the optional
BSCALE and/or BZERO keywords (that is, BSCALE != 1 and/or BZERO != 0), then
the raw data in the file must be rescaled to its physical values according to
the formula:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">physical_value</span> <span class="o">=</span> <span class="n">BZERO</span> <span class="o">+</span> <span class="n">BSCALE</span> <span class="o">*</span> <span class="n">array_value</span>
</pre></div>
</div>
<p>As BZERO and BSCALE are floating point values, the resulting value must be a
float as well.  If the original values were 16-bit integers, the resulting
values are single-precision (32-bit) floats.  If the original values were
32-bit integers the resulting values are double-precision (64-bit floats).</p>
<p>This automatic scaling can easily catch you of guard if you&#8217;re not expecting
it, because it doesn&#8217;t happen until the data portion of the HDU is accessed
(to allow things like updating the header without rescaling the data).  For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;scaled.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BITPIX&#39;</span><span class="p">]</span>
<span class="go">32</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BSCALE&#39;</span><span class="p">]</span>
<span class="go">2.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">data</span>  <span class="c"># Read the data into memory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)  # Got float64 despite BITPIX = 32 (32-bit int)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BITPIX&#39;</span><span class="p">]</span>  <span class="c"># The BITPIX will automatically update too</span>
<span class="go">-64</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;BSCALE&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="o">.</span><span class="n">header</span>  <span class="c"># And the BSCALE keyword removed</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The reason for this is that once a user accesses the data they may also
manipulate it and perform calculations on it.  If the data were forced to
remain as integers, a great deal of precision is lost.  So it is best to err
on the side of not losing data, at the cost of causing some confusion at
first.</p>
<p>If the data must be returned to integers before saving, use the <tt class="docutils literal"><span class="pre">scale()</span></tt>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BITPIX&#39;</span><span class="p">]</span>
<span class="go">32</span>
</pre></div>
</div>
<p>Alternatively, if a file is opened with <tt class="docutils literal"><span class="pre">mode='update'</span></tt> along with the
<tt class="docutils literal"><span class="pre">scale_back=True</span></tt> argument, the original BSCALE and BZERO scaling will
be automatically re-applied to the data before saving.  Usually this is
not desireable, especially when converting from floating point back to
unsigned integer values.  But this may be useful in cases where the raw
data needs to be modified corresponding to changes in the physical values.</p>
<p>To prevent rescaling from occurring at all (good for updating headers&#8211;even if
you don&#8217;t intend for the code to access the data, it&#8217;s good to err on the side
of caution here), use the <tt class="docutils literal"><span class="pre">do_not_scale_image_data</span></tt> argument when opening
the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hdul</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;scaled.fits&#39;</span><span class="p">,</span> <span class="n">do_not_scale_image_data</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="s">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int32&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="why-am-i-losing-precision-when-i-assign-floating-point-values-in-the-header">
<h3><a class="toc-backref" href="#id29">Why am I losing precision when I assign floating point values in the header?</a><a class="headerlink" href="#why-am-i-losing-precision-when-i-assign-floating-point-values-in-the-header" title="Permalink to this headline">¶</a></h3>
<p>The FITS standard allows two formats for storing floating-point numbers in a
header value.  The &#8220;fixed&#8221; format requires the ASCII representation of the
number to be in bytes 11 through 30 of the header card, and to be
right-justified.  This leaves a standard number of characters for any comment
string.</p>
<p>The fixed format is not wide enough to represent the full range of values that
can be stored in a 64-bit float with full precision.  So FITS also supports a
&#8220;free&#8221; format in which the ASCII representation can be stored anywhere, using
the full 70 bytes of the card (after the keyword).</p>
<p>Currently PyFITS only supports writing fixed format (it can read both
formats), so all floating point values assigned to a header are stored in the
fixed format.  There are plans to add support for more flexible formatting.</p>
<p>In the meantime it is possible to add or update cards by manually formatting
the card image:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s">&#39;FOO     = 1234567890.123456789&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span>
<span class="go">FOO     = 1234567890.123456789</span>
</pre></div>
</div>
<p>As long as you don&#8217;t assign new values to &#8216;FOO&#8217; via <tt class="docutils literal"><span class="pre">h['FOO']</span> <span class="pre">=</span> <span class="pre">123</span></tt>, PyFITS
will maintain the header value exactly as you formatted it.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">PyFITS FAQ</a><ul>
<li><a class="reference internal" href="#general-questions">General Questions</a><ul>
<li><a class="reference internal" href="#what-is-pyfits">What is PyFITS?</a></li>
<li><a class="reference internal" href="#what-is-the-development-status-of-pyfits">What is the development status of PyFITS?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-and-installation-questions">Build and Installation Questions</a><ul>
<li><a class="reference internal" href="#is-pyfits-available-on-windows">Is PyFITS available on Windows?</a></li>
<li><a class="reference internal" href="#where-is-the-windows-installer-for-version-x-of-pyfits-on-version-y-of-python">Where is the Windows installer for version X of PyFITS on version Y of Python?</a></li>
<li><a class="reference internal" href="#why-is-the-pyfits-installation-failing-on-windows">Why is the PyFITS installation failing on Windows?</a></li>
<li><a class="reference internal" href="#on-windows-vista-or-later-why-can-t-the-installer-find-python-in-the-registry">On Windows Vista or later why can&#8217;t the installer find Python in the registry?</a></li>
<li><a class="reference internal" href="#how-do-i-install-pyfits-from-source-on-windows">How do I install PyFITS from source on Windows?</a></li>
<li><a class="reference internal" href="#is-pyfits-available-for-mac-osx">Is PyFITS available for Mac OSX?</a></li>
<li><a class="reference internal" href="#why-is-the-pyfits-installation-failing-on-osx-lion-10-7">Why is the PyFITS installation failing on OSX Lion (10.7)?</a></li>
<li><a class="reference internal" href="#how-do-i-find-out-what-version-of-pyfits-i-have-installed">How do I find out what version of PyFITS I have installed?</a></li>
<li><a class="reference internal" href="#how-do-i-run-the-tests-for-pyfits">How do I run the tests for PyFITS?</a></li>
<li><a class="reference internal" href="#how-can-i-build-a-copy-of-the-pyfits-documentation-for-my-own-use">How can I build a copy of the PyFITS documentation for my own use?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-questions">Usage Questions</a><ul>
<li><a class="reference internal" href="#something-didn-t-work-as-i-expected-did-i-do-something-wrong">Something didn&#8217;t work as I expected.  Did I do something wrong?</a></li>
<li><a class="reference internal" href="#pyfits-crashed-and-output-a-long-string-of-code-what-do-i-do">PyFITS crashed and output a long string of code.  What do I do?</a></li>
<li><a class="reference internal" href="#why-does-opening-a-file-work-in-cfitsio-ds9-etc-but-not-in-pyfits">Why does opening a file work in CFITSIO, ds9, etc. but not in PyFITS?</a></li>
<li><a class="reference internal" href="#how-do-i-turn-off-the-warning-messages-pyfits-keeps-outputting-to-my-console">How do I turn off the warning messages PyFITS keeps outputting to my console?</a></li>
<li><a class="reference internal" href="#how-can-i-check-if-my-code-is-using-deprecated-pyfits-features">How can I check if my code is using deprecated PyFITS features?</a></li>
<li><a class="reference internal" href="#what-convention-does-pyfits-use-for-indexing-such-as-of-image-coordinates">What convention does PyFITS use for indexing, such as of image coordinates?</a></li>
<li><a class="reference internal" href="#how-do-i-open-a-very-large-image-that-won-t-fit-in-memory">How do I open a very large image that won&#8217;t fit in memory?</a></li>
<li><a class="reference internal" href="#how-can-i-create-a-very-large-fits-file-from-scratch">How can I create a very large FITS file from scratch?</a></li>
<li><a class="reference internal" href="#how-do-i-create-a-multi-extension-fits-file-from-scratch">How do I create a multi-extension FITS file from scratch?</a></li>
<li><a class="reference internal" href="#why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats">Why is an image containing integer data being converted unexpectedly to floats?</a></li>
<li><a class="reference internal" href="#why-am-i-losing-precision-when-i-assign-floating-point-values-in-the-header">Why am I losing precision when I assign floating point values in the header?</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/io/fits/appendix/faq.rst">Edit This Page on Github</a> &nbsp;
    <a href="../../../_sources/io/fits/appendix/faq.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2014, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2. &nbsp;
    Last built 15 Aug 2014. <br/>
  </p>
</footer>
  </body>
</html>